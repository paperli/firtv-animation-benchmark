#!/bin/bash

# Environment Setup Script for Fire TV Animation Benchmarking Tool
# This script helps users configure their environment variables

set -e

echo "ðŸ”§ Fire TV Animation Benchmarking Tool - Environment Setup"
echo "========================================================"

# Check if .env already exists
if [ -f .env ]; then
  echo "âš ï¸  .env file already exists. Do you want to overwrite it? (y/N)"
  read -r response
  if [[ ! "$response" =~ ^[Yy]$ ]]; then
    echo "Setup cancelled."
    exit 0
  fi
fi

echo ""
echo "Please provide the following information:"
echo ""

# Get Fire TV device IP
echo "ðŸ“± Fire TV Device Configuration"
echo "Enter your Fire TV device IP and port (e.g., 192.168.50.150:5555):"
read -r fire_tv_ip
if [ -z "$fire_tv_ip" ]; then
  fire_tv_ip="192.168.50.150:5555"
  echo "Using default: $fire_tv_ip"
fi

# Get development server IP
echo ""
echo "ðŸ’» Development Server Configuration"
echo "Enter your computer's IP address (e.g., 192.168.50.157):"
read -r dev_server_ip
if [ -z "$dev_server_ip" ]; then
  # Try to auto-detect IP
  dev_server_ip=$(ifconfig | grep "inet " | grep -v 127.0.0.1 | awk '{print $2}' | head -1)
  echo "Auto-detected: $dev_server_ip"
fi

# Get development server port
echo "Enter development server port (default: 5173):"
read -r dev_server_port
if [ -z "$dev_server_port" ]; then
  dev_server_port="5173"
fi

# Get HTTP server port
echo "Enter HTTP server port (default: 8080):"
read -r http_server_port
if [ -z "$http_server_port" ]; then
  http_server_port="8080"
fi

# Create .env file
cat > .env << EOF
# Fire TV Animation Benchmarking Tool - Environment Configuration
# Generated by setup-env.sh

# Fire TV Device Configuration
FIRE_TV_DEVICE_IP=$fire_tv_ip

# Development Server Configuration
DEV_SERVER_IP=$dev_server_ip
DEV_SERVER_PORT=$dev_server_port

# HTTP Server Configuration (for Fire TV deployment)
HTTP_SERVER_PORT=$http_server_port

# Build Configuration
BUILD_TARGET=firetv
BUILD_OPTIMIZE=true
EOF

echo ""
echo "âœ… Environment configuration created successfully!"
echo ""
echo "ðŸ“‹ Configuration Summary:"
echo "  Fire TV Device: $fire_tv_ip"
echo "  Dev Server: $dev_server_ip:$dev_server_port"
echo "  HTTP Server Port: $http_server_port"
echo ""
echo "ðŸ”§ Next steps:"
echo "  1. Test your Fire TV connection: adb devices"
echo "  2. Deploy the application: ./scripts/deploy-firetv.sh"
echo "  3. Or use quick deploy: ./scripts/deploy-simple.sh"
echo ""
echo "ðŸ“ You can edit .env file anytime to change these settings." 